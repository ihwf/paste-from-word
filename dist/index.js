!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("core-js/modules/es6.regexp.replace.js"),require("core-js/modules/es6.object.to-string.js"),require("core-js/modules/es6.promise.js"),require("core-js/modules/es6.array.map.js"),require("core-js/modules/es6.string.iterator.js"),require("core-js/modules/es6.array.iterator.js"),require("core-js/modules/web.dom.iterable.js"),require("core-js/modules/es6.regexp.constructor.js"),require("core-js/modules/es6.array.filter.js"),require("core-js/modules/es6.regexp.match.js"),require("core-js/modules/es6.array.find.js"),require("core-js/modules/es6.typed.uint8-array.js"),require("core-js/modules/es6.object.keys.js"),require("core-js/modules/es6.number.constructor.js"),require("core-js/modules/es6.array.slice.js"),require("core-js/modules/es6.regexp.to-string.js")):"function"==typeof define&&define.amd?define(["core-js/modules/es6.regexp.replace.js","core-js/modules/es6.object.to-string.js","core-js/modules/es6.promise.js","core-js/modules/es6.array.map.js","core-js/modules/es6.string.iterator.js","core-js/modules/es6.array.iterator.js","core-js/modules/web.dom.iterable.js","core-js/modules/es6.regexp.constructor.js","core-js/modules/es6.array.filter.js","core-js/modules/es6.regexp.match.js","core-js/modules/es6.array.find.js","core-js/modules/es6.typed.uint8-array.js","core-js/modules/es6.object.keys.js","core-js/modules/es6.number.constructor.js","core-js/modules/es6.array.slice.js","core-js/modules/es6.regexp.to-string.js"],r):(e="undefined"!=typeof globalThis?globalThis:e||self).PasteFromWord=r()}(this,function(){"use strict";function r(r,e){var t,n=Object.keys(r);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(r),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),n.push.apply(n,t)),n}function e(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?r(Object(o),!0).forEach(function(e){var r,t;r=n,e=o[t=e],t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u={merge:function(e,r){var t=u.clone(e),n=u.clone(r);return u.forEach(Object.keys(n),function(e){"object"===s(n[e])&&"object"===s(t[e])?t[e]=u.merge(t[e],n[e]):t[e]=n[e]}),t},clone:function(e){var r,t;if(e&&e instanceof Array){r=[];for(var n=0;n<e.length;n++)r[n]=u.clone(e[n]);return r}if(null===e||"object"!==s(e)||e instanceof String||e instanceof Number||e instanceof Boolean||e instanceof Date||e instanceof RegExp)return e;if(e.nodeType||e.window===e)return e;for(t in r=new e.constructor,e){var o=e[t];r[t]=u.clone(o)}return r},forEach:function(e,r,t){for(var n=e.length,o=0;o<n;o++)r.call(t,e[o],o,e)},find:function(e,r,t){for(var n=e.length,o=0;o<n;){if(r.call(t,e[o],o,e))return e[o];o++}},indexOf:function(e,r){if("function"==typeof r){for(var t=0,n=e.length;t<n;t++)if(r(e[t]))return t}else{if(e.indexOf)return e.indexOf(r);for(t=0,n=e.length;t<n;t++)if(e[t]===r)return t}return-1},map:function(e,r,t){for(var n=[],o=0;o<e.length;o++)n.push(r.call(t,e[o],o,e));return n},filter:function(t,n,o){var s=[];return u.forEach(t,function(e,r){n.call(o,e,r,t)&&s.push(e)}),s},unique:function(t){return u.filter(t,function(e,r){return r===u.indexOf(t,e)})},createXMLHttpRequest:function(){var e=navigator.userAgent.toLowerCase(),r=e.match(/edge[ \/](\d+.?\d*)/),e=-1<e.indexOf("trident/");if(!!(!r&&!e)||"file:"!==location.protocol)try{return new XMLHttpRequest}catch(e){console.log(e)}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){console.log(e)}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){console.log(e)}return null},checkStatus:function(e){return 4===e.readyState&&(200<=e.status&&e.status<300||304===e.status||0===e.status||1223===e.status)},getResponse:function(e,r){if(!u.checkStatus(e))return null;switch(r){case"text":return e.responseText;case"arraybuffer":return e.response;default:return null}},load:function(e,r,t){var n=!!r,o=u.createXMLHttpRequest();return o?(n&&"text"!==t&&"xml"!==t&&(o.responseType=t),o.open("GET",e,n),n&&(o.onreadystatechange=function(){4===o.readyState&&(r(u.getResponse(o,t)),o=null)}),o.send(null),n?"":u.getResponse(o,t)):null}},c={getGroups:function(e,r){for(var t,n=[],o=0;t=c.getGroup(e,r,{start:o});)o=t.end,n.push(t);return n},removeGroups:function(e,r){for(var t;t=c.getGroup(e,r);)e=e.substring(0,t.start)+e.substring(t.end);return e},getGroup:function(e,r,t){var n,o,s=0,r=new RegExp("\\{\\\\"+r,"g");if(t=u.merge({start:0},t||{}),r.lastIndex=t.start,!(r=r.exec(e)))return null;o=e[n=r.index];do{var a="{"===o&&"\\"!==c.getPreviousNonWhitespaceChar(e,n)&&"\\"===c.getNextNonWhitespaceChar(e,n),i="}"===o&&"\\"!==c.getPreviousNonWhitespaceChar(e,n)&&0<s}while(a?s++:i&&s--,(o=e[++n])&&0<s);return{start:r.index,end:n,content:e.substring(r.index,n)}},extractGroupContent:function(e){var r=c.getGroupName(e);return e=e.replace(/\}([^{\s]+)/g,"} $1"),(e=(e=c.removeGroups(e,"(?!"+r+")")).replace(/^\{(\\[\w-]+\s*)+/g,"").trim()).replace(/}$/,"")},getGroupName:function(e){e=e.match(/^\{\\(\w+)/);return e?e[1]:null},getNonWhitespaceChar:function(e,r,t){for(var n=r+t,o=e[n],s=/[\s]/;o&&s.test(o);)o=e[n+=t];return o},getPreviousNonWhitespaceChar:function(e,r){return c.getNonWhitespaceChar(e,r,-1)},getNextNonWhitespaceChar:function(e,r){return c.getNonWhitespaceChar(e,r,1)}},t={convertHexStringToBytes:function(e){for(var r=[],t=e.length/2,n=0;n<t;n++)r.push(parseInt(e.substr(2*n,2),16));return r},convertBytesToBase64:function(e){for(var r="",t=e.length,n=0;n<t;n+=3){var o,s=e.slice(n,n+3),a=s.length,i=[];if(a<3)for(o=a;o<3;o++)s[o]=0;for(i[0]=(252&s[0])>>2,i[1]=(3&s[0])<<4|s[1]>>4,i[2]=(15&s[1])<<2|(192&s[2])>>6,i[3]=63&s[2],o=0;o<4;o++)r+=o<=a?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i[o]):"="}return r},getImageTypeFromSignature:function(e){var e=e.subarray(0,4),r=u.map(e,function(e){return e.toString(16)}).join(""),e=u.find([{signature:"ffd8ff",type:"image/jpeg"},{signature:"47494638",type:"image/gif"},{signature:"89504e47",type:"image/png"}],function(e){return 0===r.indexOf(e.signature)});return e?e.type:null}},p=e(e(e({},u),c),t);return function(){function r(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),this.imageHandler=e&&e.imageHandler,this.supportedImageTypes=["image/png","image/jpeg","image/gif"]}var e,t,n;return e=r,(t=[{key:"parse",value:function(e,r){this.e=e;e=this.clipboardData=e.clipboardData;this.parser(e,r)}},{key:"checkPaster",value:function(e){var r=this.getClipboardData(e,"html"),e=this.getContentGeneratorName(r),e=e?"microsoft"===e:/(class="?Mso|style=["'][^"]*?\bmso\-|w:WordDocument|<o:\w+>|<\/font>)/.test(r);return r&&e}},{key:"getClipboardData",value:function(e,r){return e.getData("text/".concat(r))}},{key:"getContentGeneratorName",value:function(e){e=/<meta\s+name=["']?generator["']?\s+content=["']?(\w+)/gi.exec(e);if(e&&e.length){e=e[1].toLowerCase();return 0===e.indexOf("microsoft")?"microsoft":0===e.indexOf("libreoffice")?"libreoffice":"unknown"}}},{key:"parser",value:function(e,r){var t=this.stripHtml(this.getClipboardData(e,"html")),n=this.getClipboardData(e,"plain"),e=this.getClipboardData(e,"rtf"),o={html:t,text:n,rtf:e};this.filterRtfImageToHtml(o.html,e).then(function(e){o.html=e,r(o)})}},{key:"stripHtml",value:function(e){var r=e;return r&&r.length&&(r=r.replace(/^<meta.*?>/i,""),(e=/<body(?:[\s\S]*?)>([\s\S]*)<\/body>/i.exec(r))&&e.length&&(r=(r=e[1]).replace(/\s*<!--StartFragment-->|<!--EndFragment-->\s*/g,""))),r}},{key:"filterRtfImageToHtml",value:function(e,r){var t=this.extractTagsFromHtml(e);return 0===t.length?Promise.resolve(e):r?this.handleRtfImages(e,r,t):this.handleBlobImages(e,t)}},{key:"extractTagsFromHtml",value:function(e){for(var r,t=/<img[^>]+src="([^"]+)[^>]+/g,n=[];r=t.exec(e);)n.push(r[1]);return n}},{key:"handleRtfImages",value:function(o,e,s){var r=this,a=this.extractFromRtf(e);return new Promise(function(n){var e;0===a.length&&n(o),e=r.imageHandler?p.map(a,r.imageHandlerWrapper,r):p.map(a,function(e){return Promise.resolve(r.createSrcWithBase64(e))},r),Promise.all(e).then(function(e){s.length!==e.length&&(console.error("处理rtf图片异常!处理后的图片数量与处理前不一致",{rtf:a.length,html:s.length}),n(o));for(var r,t=0;t<s.length;t++)0===s[t].indexOf("file://")&&(e[t]?(r=s[t].replace(/\\/g,"\\\\"),r=new RegExp("(<img [^>]*src=[\"']?)"+r),o=o.replace(r,"$1"+e[t])):console.error("处理后的图片中未找到第"+(t+1)+"张图片",{type:a[t].type,index:t}));n(o)})})}},{key:"handleBlobImages",value:function(n,e){var o=p.unique(p.filter(e,function(e){return e.match(/^blob:/i)})),t=p.map(o,this.convertBlobUrlToBase64.bind(this));return new Promise(function(r){Promise.all(t).then(function(e){p.forEach(e,function(e,r){var t;e?(t=o[r],n=n.replace(new RegExp(t,"g"),e)):console.error("转换blob格式图片为base64格式异常",{type:"blob",index:r})}),r(n)})})}},{key:"extractFromRtf",value:function(e){var t=[];e=p.removeGroups(e,"(?:(?:header|footer)[lrf]?|nonshppict|shprslt)");var r=p.getGroups(e,"pict");if(!r)return t;for(var n=0;n<r.length;n++){var o=r[n].content,s=function(e){var r=e.match(/\\blipuid (\w+)\}/),e=e.match(/\\bliptag(-?\d+)/);{if(r)return r[1];if(e)return e[1]}return null}(o),a=function(r){var e=p.find([{marker:/\\pngblip/,type:"image/png"},{marker:/\\jpegblip/,type:"image/jpeg"},{marker:/\\emfblip/,type:"image/emf"},{marker:/\\wmetafile\d/,type:"image/wmf"}],function(e){return e.marker.test(r)});if(e)return e.type;return"unknown"}(o),i=function(r){return"string"==typeof r?p.indexOf(t,function(e){return e.id===r}):-1}(s),u=-1!==i&&t[i].hex,c=u&&t[i].type===a,l=u&&t[i].type!==a&&i===t.length-1,f=-1!==o.indexOf("\\defshp"),u=-1!==p.indexOf(this.supportedImageTypes,a);c?t.push(t[i]):l||f||(a={id:s,hex:u?p.extractGroupContent(o).replace(/\s/g,""):null,type:a},-1!==i?t.splice(i,1,a):t.push(a))}return t}},{key:"createSrcWithBase64",value:function(e){var r=-1!==p.indexOf(this.supportedImageTypes,e.type),t=e.hex;return r?("string"==typeof t&&(t=p.convertHexStringToBytes(e.hex)),e.type?"data:"+e.type+";base64,"+p.convertBytesToBase64(t):null):null}},{key:"convertBlobUrlToBase64",value:function(e){var t=this;return new Promise(function(r){p.load(e,function(e){e=new Uint8Array(e),e={type:p.getImageTypeFromSignature(e),hex:e};t.imageHandler?t.imageHandlerWrapper(e).then(r):(e=t.createSrcWithBase64(e),r(e))},"arraybuffer")})}},{key:"createBlobWithImageInfo",value:function(e){var r=-1!==p.indexOf(this.supportedImageTypes,e.type),t=e.hex;if(!r)return null;"string"==typeof t&&(t=p.convertHexStringToBytes(e.hex));for(var r=new ArrayBuffer(t.length),n=new Uint8Array(r),o=0;o<t.length;o++)n[o]=t[o];return new Blob([n],{type:e.type})}},{key:"imageHandlerWrapper",value:function(r){var t=this;return new Promise(function(e){t.imageHandler(t.createBlobWithImageInfo(r),e)})}}])&&o(e.prototype,t),n&&o(e,n),r}()});
